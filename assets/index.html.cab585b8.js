import{_ as a,o as s,c as n,a as e}from"./app.97bc6cd8.js";const t={},p=e(`<p>ClickHouse \u662F\u8FD1\u5E74\u975E\u5E38\u6D41\u884C\u7684\u5F00\u6E90\u5217\u5F0F\u6570\u636E\u5E93\uFF0C\u4E3B\u6253\u6781\u81F4\u7684\u5206\u6790\u578B\uFF08OLAP\uFF09\u67E5\u8BE2\u6027\u80FD\uFF0C\u9002\u7528\u4E8E\u65E5\u5FD7\u5206\u6790\u3001\u6570\u636E\u4ED3\u5E93\u3001BI \u7B49\u5927\u6570\u636E\u573A\u666F\u3002\u8FD9\u91CC\u5206\u4EAB\u4E0B ClickHouse \u7684\u6838\u5FC3\u539F\u7406\u3001Docker \u90E8\u7F72\u3001\u5E38\u89C1 SQL \u64CD\u4F5C\u548C\u5B9E\u7528\u6280\u5DE7\uFF0C\u5E2E\u52A9\u65B0\u624B\u5FEB\u901F\u4E0A\u624B\u3002</p><h2 id="\u4E00\u3001clickhouse-\u7B80\u4ECB" tabindex="-1"><a class="header-anchor" href="#\u4E00\u3001clickhouse-\u7B80\u4ECB" aria-hidden="true">#</a> \u4E00\u3001ClickHouse \u7B80\u4ECB</h2><ul><li><strong>\u5217\u5F0F\u5B58\u50A8</strong>\uFF1A\u6570\u636E\u6309\u5217\u5B58\u50A8\uFF0C\u9002\u5408\u5206\u6790\u578B\u805A\u5408\u67E5\u8BE2\uFF0C\u538B\u7F29\u6BD4\u9AD8\uFF0CI/O \u6548\u7387\u9AD8\u3002</li><li><strong>\u9AD8\u5E76\u53D1\u9AD8\u6027\u80FD</strong>\uFF1A\u5929\u751F\u9002\u5408\u5927\u6570\u636E\u91CF\u3001\u590D\u6742\u805A\u5408\u7EDF\u8BA1\u3001\u5B9E\u65F6\u5206\u6790\u3002</li><li><strong>\u4E30\u5BCC\u7684 SQL \u652F\u6301</strong>\uFF1A\u517C\u5BB9\u6807\u51C6 SQL\uFF0C\u652F\u6301\u7A97\u53E3\u51FD\u6570\u3001\u5206\u533A\u3001\u5206\u5E03\u5F0F\u8868\u7B49\u3002</li><li><strong>\u6613\u4E8E\u6269\u5C55</strong>\uFF1A\u5355\u673A\u3001\u96C6\u7FA4\u5747\u652F\u6301\uFF0C\u6269\u5BB9\u65B9\u4FBF\u3002</li></ul><h2 id="\u4E8C\u3001docker-\u5FEB\u901F\u90E8\u7F72" tabindex="-1"><a class="header-anchor" href="#\u4E8C\u3001docker-\u5FEB\u901F\u90E8\u7F72" aria-hidden="true">#</a> \u4E8C\u3001Docker \u5FEB\u901F\u90E8\u7F72</h2><p>\u6700\u7B80\u5355\u7684\u65B9\u5F0F\u662F\u7528\u5B98\u65B9 Docker \u955C\u50CF\uFF1A</p><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">--name</span> clickhouse-server <span class="token parameter variable">--ulimit</span> <span class="token assign-left variable">nofile</span><span class="token operator">=</span><span class="token number">262144</span>:262144 <span class="token punctuation">\\</span>
  <span class="token parameter variable">-p</span> <span class="token number">8123</span>:8123 <span class="token parameter variable">-p</span> <span class="token number">9000</span>:9000 <span class="token parameter variable">-p</span> <span class="token number">9009</span>:9009 <span class="token punctuation">\\</span>
  <span class="token parameter variable">-v</span> <span class="token environment constant">$PWD</span>/clickhouse/data:/var/lib/clickhouse <span class="token punctuation">\\</span>
  <span class="token parameter variable">-v</span> <span class="token environment constant">$PWD</span>/clickhouse/config.xml:/etc/clickhouse-server/config.xml <span class="token punctuation">\\</span>
  yandex/clickhouse-server:latest
</code></pre></div><ul><li>8123\uFF1AHTTP \u63A5\u53E3\uFF08\u53EF\u7528 curl \u6216\u6D4F\u89C8\u5668\u8BBF\u95EE\uFF09</li><li>9000\uFF1ANative TCP \u534F\u8BAE\uFF08\u5BA2\u6237\u7AEF/\u9A71\u52A8\u7528\uFF09</li><li>9009\uFF1A\u7528\u4E8E\u5185\u90E8\u901A\u4FE1\u3001\u76D1\u63A7</li></ul><p><strong>\u4E5F\u53EF\u4EE5\u7528 docker-compose \u7BA1\u7406\uFF1A</strong></p><div class="language-yaml ext-yml"><pre class="language-yaml"><code><span class="token key atrule">clickhouse</span><span class="token punctuation">:</span>
  <span class="token key atrule">image</span><span class="token punctuation">:</span> yandex/clickhouse<span class="token punctuation">-</span>server<span class="token punctuation">:</span>latest
  <span class="token key atrule">container_name</span><span class="token punctuation">:</span> clickhouse
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token string">&quot;8123:8123&quot;</span>
    <span class="token punctuation">-</span> <span class="token string">&quot;9000:9000&quot;</span>
  <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> ./clickhouse/data<span class="token punctuation">:</span>/var/lib/clickhouse
    <span class="token punctuation">-</span> ./clickhouse/config.xml<span class="token punctuation">:</span>/etc/clickhouse<span class="token punctuation">-</span>server/config.xml
</code></pre></div><h2 id="\u4E09\u3001\u5BA2\u6237\u7AEF\u8FDE\u63A5\u65B9\u5F0F" tabindex="-1"><a class="header-anchor" href="#\u4E09\u3001\u5BA2\u6237\u7AEF\u8FDE\u63A5\u65B9\u5F0F" aria-hidden="true">#</a> \u4E09\u3001\u5BA2\u6237\u7AEF\u8FDE\u63A5\u65B9\u5F0F</h2><ul><li><strong>\u547D\u4EE4\u884C\u5BA2\u6237\u7AEF</strong>\uFF1A<div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> clickhouse-server clickhouse-client
</code></pre></div></li><li><strong>HTTP API</strong>\uFF1A<br> \u76F4\u63A5\u7528 curl\uFF1A<div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token function">curl</span> <span class="token string">&#39;http://localhost:8123/?query=SELECT+1&#39;</span>
</code></pre></div></li><li><strong>GUI \u5DE5\u5177</strong>\uFF1A\u5982 DBeaver\u3001Tabix\u3001DataGrip\u3001\u5B98\u65B9 ClickHouse Keeper\u3002</li></ul><h2 id="\u56DB\u3001\u5EFA\u8868\u4E0E\u57FA\u7840-sql" tabindex="-1"><a class="header-anchor" href="#\u56DB\u3001\u5EFA\u8868\u4E0E\u57FA\u7840-sql" aria-hidden="true">#</a> \u56DB\u3001\u5EFA\u8868\u4E0E\u57FA\u7840 SQL</h2><h3 id="_1-\u5EFA\u8868" tabindex="-1"><a class="header-anchor" href="#_1-\u5EFA\u8868" aria-hidden="true">#</a> 1. \u5EFA\u8868</h3><div class="language-sql ext-sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> test<span class="token punctuation">.</span>events <span class="token punctuation">(</span>
    event_date <span class="token keyword">Date</span><span class="token punctuation">,</span>
    event_id   UInt32<span class="token punctuation">,</span>
    user_id    UInt64<span class="token punctuation">,</span>
    <span class="token keyword">action</span>     String
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> MergeTree<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> toYYYYMM<span class="token punctuation">(</span>event_date<span class="token punctuation">)</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token punctuation">(</span>event_date<span class="token punctuation">,</span> event_id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>MergeTree \u662F\u6700\u5E38\u7528\u7684 OLAP \u8868\u5F15\u64CE\u3002</li><li>\u5206\u533A\u5B57\u6BB5\u5EFA\u8BAE\u7528\u65E5\u671F\uFF0CORDER BY \u5F71\u54CD\u67E5\u8BE2\u6027\u80FD\u3002</li></ul><h3 id="_2-\u63D2\u5165\u6570\u636E" tabindex="-1"><a class="header-anchor" href="#_2-\u63D2\u5165\u6570\u636E" aria-hidden="true">#</a> 2. \u63D2\u5165\u6570\u636E</h3><div class="language-sql ext-sql"><pre class="language-sql"><code><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test<span class="token punctuation">.</span>events <span class="token punctuation">(</span>event_date<span class="token punctuation">,</span> event_id<span class="token punctuation">,</span> user_id<span class="token punctuation">,</span> <span class="token keyword">action</span><span class="token punctuation">)</span>
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">&#39;2025-06-20&#39;</span><span class="token punctuation">,</span> <span class="token number">1001</span><span class="token punctuation">,</span> <span class="token number">123456</span><span class="token punctuation">,</span> <span class="token string">&#39;login&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_3-\u67E5\u8BE2\u793A\u4F8B" tabindex="-1"><a class="header-anchor" href="#_3-\u67E5\u8BE2\u793A\u4F8B" aria-hidden="true">#</a> 3. \u67E5\u8BE2\u793A\u4F8B</h3><p>\u805A\u5408\u7EDF\u8BA1\uFF1A</p><div class="language-sql ext-sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span>
  event_date<span class="token punctuation">,</span>
  <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> total<span class="token punctuation">,</span>
  <span class="token function">count</span><span class="token punctuation">(</span><span class="token keyword">DISTINCT</span> user_id<span class="token punctuation">)</span> <span class="token keyword">AS</span> uv
<span class="token keyword">FROM</span> test<span class="token punctuation">.</span>events
<span class="token keyword">WHERE</span> event_date <span class="token operator">&gt;=</span> <span class="token string">&#39;2025-06-01&#39;</span>
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> event_date
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> event_date<span class="token punctuation">;</span>
</code></pre></div><p>\u7B80\u5355\u67E5\u8BE2\uFF1A</p><div class="language-sql ext-sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> test<span class="token punctuation">.</span>events <span class="token keyword">WHERE</span> user_id <span class="token operator">=</span> <span class="token number">123456</span> <span class="token keyword">LIMIT</span> <span class="token number">10</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="\u4E94\u3001\u5E38\u7528\u9AD8\u7EA7\u7279\u6027" tabindex="-1"><a class="header-anchor" href="#\u4E94\u3001\u5E38\u7528\u9AD8\u7EA7\u7279\u6027" aria-hidden="true">#</a> \u4E94\u3001\u5E38\u7528\u9AD8\u7EA7\u7279\u6027</h2><h3 id="_1-\u6279\u91CF\u5BFC\u5165\u6570\u636E" tabindex="-1"><a class="header-anchor" href="#_1-\u6279\u91CF\u5BFC\u5165\u6570\u636E" aria-hidden="true">#</a> 1. \u6279\u91CF\u5BFC\u5165\u6570\u636E</h3><ul><li><p>CSV \u5BFC\u5165\uFF1A</p><div class="language-bash ext-sh"><pre class="language-bash"><code>clickhouse-client <span class="token parameter variable">--query</span><span class="token operator">=</span><span class="token string">&quot;INSERT INTO test.events FORMAT CSV&quot;</span> <span class="token operator">&lt;</span> data.csv
</code></pre></div></li><li><p>JSON \u5BFC\u5165\uFF1A</p><div class="language-bash ext-sh"><pre class="language-bash"><code>clickhouse-client <span class="token parameter variable">--query</span><span class="token operator">=</span><span class="token string">&quot;INSERT INTO test.events FORMAT JSONEachRow&quot;</span> <span class="token operator">&lt;</span> data.json
</code></pre></div></li></ul><h3 id="_2-\u7269\u5316\u89C6\u56FE-materialized-view" tabindex="-1"><a class="header-anchor" href="#_2-\u7269\u5316\u89C6\u56FE-materialized-view" aria-hidden="true">#</a> 2. \u7269\u5316\u89C6\u56FE\uFF08Materialized View\uFF09</h3><p>\u505A\u5B9E\u65F6\u805A\u5408\u3001\u52A0\u901F\u67E5\u8BE2\uFF1A</p><div class="language-sql ext-sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> MATERIALIZED <span class="token keyword">VIEW</span> test<span class="token punctuation">.</span>daily_count
<span class="token keyword">ENGINE</span> <span class="token operator">=</span> SummingMergeTree<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> toYYYYMM<span class="token punctuation">(</span>event_date<span class="token punctuation">)</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> event_date
<span class="token keyword">AS</span>
<span class="token keyword">SELECT</span> event_date<span class="token punctuation">,</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> cnt
<span class="token keyword">FROM</span> test<span class="token punctuation">.</span>events
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> event_date<span class="token punctuation">;</span>
</code></pre></div><h3 id="_3-ttl-\u81EA\u52A8\u6E05\u7406\u5386\u53F2\u6570\u636E" tabindex="-1"><a class="header-anchor" href="#_3-ttl-\u81EA\u52A8\u6E05\u7406\u5386\u53F2\u6570\u636E" aria-hidden="true">#</a> 3. TTL \u81EA\u52A8\u6E05\u7406\u5386\u53F2\u6570\u636E</h3><div class="language-sql ext-sql"><pre class="language-sql"><code><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> test<span class="token punctuation">.</span>events
<span class="token keyword">MODIFY</span> <span class="token keyword">COLUMN</span> event_date <span class="token keyword">Date</span> TTL event_date <span class="token operator">+</span> <span class="token keyword">INTERVAL</span> <span class="token number">30</span> <span class="token keyword">DAY</span><span class="token punctuation">;</span>
</code></pre></div><p>30 \u5929\u81EA\u52A8\u6E05\u7406\u8FC7\u671F\u5206\u533A\u3002</p><h3 id="_4-\u5206\u5E03\u5F0F\u8868" tabindex="-1"><a class="header-anchor" href="#_4-\u5206\u5E03\u5F0F\u8868" aria-hidden="true">#</a> 4. \u5206\u5E03\u5F0F\u8868</h3><p>\u9002\u5408\u591A\u8282\u70B9\u96C6\u7FA4\uFF0C\u5355\u673A\u53EF\u7565\u3002</p><h2 id="\u516D\u3001\u6027\u80FD\u4E0E\u8FD0\u7EF4\u5EFA\u8BAE" tabindex="-1"><a class="header-anchor" href="#\u516D\u3001\u6027\u80FD\u4E0E\u8FD0\u7EF4\u5EFA\u8BAE" aria-hidden="true">#</a> \u516D\u3001\u6027\u80FD\u4E0E\u8FD0\u7EF4\u5EFA\u8BAE</h2><ul><li>\u5EFA\u8868\u65F6 ORDER BY \u5F71\u54CD\u6570\u636E\u5199\u5165\u548C\u540E\u7EED\u67E5\u8BE2\u6548\u7387\uFF0C\u5EFA\u8BAE\u7528\u5E38\u7528\u7684\u8FC7\u6EE4\u5B57\u6BB5\u3002</li><li>\u5B9A\u671F OPTIMIZE TABLE \u5408\u5E76\u5C0F\u5206\u533A\uFF0C\u63D0\u5347\u67E5\u8BE2\u6548\u7387\u3002</li><li>\u67E5\u8BE2\u6162\u65F6\u53EF\u7528 <code>EXPLAIN</code> \u6216 <code>system.query_log</code> \u8BCA\u65AD\u3002</li><li>\u63A8\u8350\u4F7F\u7528 MergeTree \u7CFB\u5217\u8868\u5F15\u64CE\uFF08ReplacingMergeTree\u3001AggregatingMergeTree \u7B49\uFF09\u6839\u636E\u4E1A\u52A1\u573A\u666F\u9009\u62E9\u3002</li><li>\u751F\u4EA7\u73AF\u5883\u6CE8\u610F\u5185\u5B58\u3001\u78C1\u76D8\u7A7A\u95F4\u4E0E\u6587\u4EF6\u53E5\u67C4\u9650\u5236\u3002</li></ul><h2 id="\u4E03\u3001\u5E38\u89C1\u95EE\u9898" tabindex="-1"><a class="header-anchor" href="#\u4E03\u3001\u5E38\u89C1\u95EE\u9898" aria-hidden="true">#</a> \u4E03\u3001\u5E38\u89C1\u95EE\u9898</h2><ol><li><p><strong>\u65E0\u6CD5\u8FDE\u63A5 9000 \u7AEF\u53E3\uFF1F</strong><br> \u68C0\u67E5\u9632\u706B\u5899\u3001\u7AEF\u53E3\u6620\u5C04\u548C config.xml \u914D\u7F6E\u3002</p></li><li><p><strong>\u6570\u636E\u65E0\u6CD5\u5199\u5165\uFF1F</strong><br> \u68C0\u67E5\u8868\u7ED3\u6784\u4E0E\u5BFC\u5165\u683C\u5F0F\uFF0C\u65E5\u5FD7\u53EF\u7528 <code>docker logs clickhouse-server</code> \u67E5\u770B\u3002</p></li><li><p><strong>\u67E5\u8BE2\u6162\uFF1F</strong><br> \u4F18\u5316 ORDER BY\u3001\u5206\u533A\u5B57\u6BB5\uFF0C\u907F\u514D\u5168\u8868\u626B\u63CF\uFF0C\u5584\u7528\u7269\u5316\u89C6\u56FE\u3002</p></li></ol><h2 id="\u516B\u3001\u7ED3\u8BED" tabindex="-1"><a class="header-anchor" href="#\u516B\u3001\u7ED3\u8BED" aria-hidden="true">#</a> \u516B\u3001\u7ED3\u8BED</h2><p>ClickHouse \u4F5C\u4E3A\u65B0\u4E00\u4EE3\u9AD8\u6027\u80FD\u5206\u6790\u578B\u6570\u636E\u5E93\uFF0C\u5DF2\u7ECF\u5728\u65E5\u5FD7\u3001\u76D1\u63A7\u3001\u6570\u636E\u4ED3\u5E93\u3001BI \u7B49\u573A\u666F\u5927\u89C4\u6A21\u5E94\u7528\u3002\u914D\u5408 Prometheus/Grafana \u7B49\u89C2\u6D4B\u7CFB\u7EDF\uFF0C\u6216\u8005\u76F4\u63A5\u4F5C\u4E3A\u4E1A\u52A1\u5206\u6790\u5F15\u64CE\uFF0C\u90FD\u662F\u6781\u4F73\u9009\u62E9\u3002</p><p>\u6B22\u8FCE\u4EA4\u6D41\u4F60\u7684 ClickHouse \u5B9E\u8DF5\u7ECF\u9A8C\uFF01</p><hr><blockquote><p>\u53C2\u8003\u8D44\u6599</p><ul><li><a href="https://clickhouse.com/docs/zh/" target="_blank" rel="noopener noreferrer">ClickHouse \u5B98\u65B9\u6587\u6863</a></li><li><a href="https://clickhouse.com/docs/zh/sql-reference/" target="_blank" rel="noopener noreferrer">ClickHouse SQL \u6559\u7A0B</a></li><li><a href="https://hub.docker.com/r/yandex/clickhouse-server" target="_blank" rel="noopener noreferrer">ClickHouse DockerHub</a></li></ul></blockquote>`,42),o=[p];function c(l,r){return s(),n("div",null,o)}var u=a(t,[["render",c],["__file","index.html.vue"]]);export{u as default};
