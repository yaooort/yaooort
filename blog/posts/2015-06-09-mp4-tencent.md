---
layout: Post
title: macOS è·å–è…¾è®¯è§†é¢‘ç¼“å­˜è§†é¢‘æ–‡ä»¶å¹¶è½¬ä¸ºmp4
subtitle: è…¾è®¯è§†é¢‘æ˜¯å¦å¯ä»¥ä¿å­˜
author: Oort
date: 2015-06-09
useHeaderImage: true
headerImage: /img/in-post/2017-06-09/header.jpeg
headerMask: rgb(14, 21, 5, .2)
permalinkPattern: /post/:year/:month/:day/:slug/
tags:
  - çç©
---

å…³äºå¦‚ä½•èƒ½æŠŠè…¾è®¯è§†é¢‘ä¸‹è½½ä¸‹æ¥çš„ç“¦ç‰¹

<!-- more -->

> äº‹ä»¶èµ·å› 

##### æœ€è¿‘æ²¡ç½‘ï¼Œå‰ä¸¤å¤©å»æœ‹å‹é‚£ç¼“å­˜äº†å‡ éƒ¨ç”µå½±ï¼Œ1080pé«˜æ¸…è§†é¢‘ä¸‹è½½é€Ÿåº¦åˆ·åˆ·çš„ã€‚æ‹¿å›æ¥æ’­æ”¾çš„æ—¶å€™å°±åœ¨æƒ³ï¼Œæˆ‘æŠŠè§†é¢‘ç¼“å­˜åˆ°ç”µè„‘äº†ï¼Œé‚£æˆ‘èƒ½æ‰¾åˆ°å—ï¼Ÿè§†é¢‘æ˜¯ä»¥mp4æ–‡ä»¶ç¼“å­˜çš„å—ï¼Ÿæˆ‘èƒ½ä¸èƒ½æ‹¿åˆ°è…¾è®¯VIPä¼šå‘˜çš„ç¼“å­˜è§†é¢‘ï¼Ÿèƒ½ä¸èƒ½ä¿å­˜é«˜æ¸…mp4ï¼Ÿ

> äº‹ä»¶ç»è¿‡

##### æ‹¿ç€è¿™äº›ç–‘é—®ï¼Œæˆ‘å°±æ‰’æ‹‰æˆ‘ç”µè„‘(macOS è…¾è®¯è§†é¢‘macç‰ˆ1.8.2)é‡Œé¢çš„ç¼“å­˜æ–‡ä»¶ï¼Œå‘ç°è§†é¢‘ç¼“å­˜åœ¨ğŸ‘‡è¿™ä¸ªç›®å½•

```/Users/ç”¨æˆ·/Library/Containers/com.tencent.tenvideo/Data/Library/Application Support/Download```

##### æ‰“å¼€é‡Œé¢çš„videoæ–‡ä»¶å¤¹ä¸€çœ‹ï¼Œæˆ‘æ»´ä¸ªç¥ã€‚

> ad			g00208rhr0m.320092.hls	l0019sl1ggv.321003.hls
> c00226jie90.321003.hls	j0022vz0heu.321003.hls

##### çœ‹æ–‡ä»¶å¤¹ç»“å°¾çš„åå­—hls \(^o^)/~ ï¼Œå†æ‰“å¼€ç¿»åˆ°æœ€é‡Œé¢ï¼Œå‘ç°é‡Œé¢çš„æ–‡ä»¶æ˜¯.ts è€Œä¸”å¯ä»¥æ­£å¸¸æ’­æ”¾ï¼Œæ³¨æ„å¯ä»¥æ­£å¸¸æ’­æ”¾çš„å“¦ï¼ŒğŸ˜ï¼Œï¼ˆæˆ‘è¿˜ä»¥ä¸ºè…¾è®¯ä¼šè‡ªå®šä¹‰è§†é¢‘å¤´ä¿¡æ¯ï¼Œè‡ªå®šä¹‰æ’­æ”¾å™¨ã€‚çœ‹åˆ°è¿™å°±æ”¾å¿ƒäº†ï¼‰ç›´æ¥ä½¿ç”¨ffmpegåˆå¹¶ä¸ºä¸€ä¸ªè§†é¢‘å°±è¡Œã€‚

##### å†ç„¶åæ¬å‡ºPythonå¤§å®å‰‘ï¼Œå¼€å§‹åŠˆæŸ´ã€‚

```python
import os,sys
import logging
from ffmpy import FFmpeg
from natsort import natsorted

logger = logging.getLogger(__name__)


def hls_dir_to_mp4(in_path_dir, out_path_file):
    """
    å°†hlsæ–‡ä»¶å¤¹é‡Œé¢åˆ†ç‰‡çš„è§†é¢‘è½¬åŒ–ä¸ºå•ä¸ªMP4æ–‡ä»¶
    ffmpeg -i "concat:file001.ts|file002.ts|file003.ts|file004.ts......n.ts" -acodec copy -vcodec copy -absf aac_adtstoasc out.mp4
    :param in_path:
    :param out_path:
    :return:
    """
    # è·å–"concat:file001.ts|file002.ts|file003.ts|file004.ts......n.ts"åˆ—è¡¨å‚æ•°
    out_files = []
    for dir in natsorted([val for val in os.listdir(in_path_dir) if val.startswith(in_path_dir.split("/")[-1])]):
        dirPath = os.path.join(in_path_dir, dir)
        print(dirPath)

        for root, dirs, files in os.walk(dirPath):
            files = natsorted(files)
            for file in files:
                if os.path.splitext(file)[1] == '.ts':
                    # æ‹¼æ¥æˆå®Œæ•´è·¯å¾„
                    filePath = os.path.join(root, file)
                    out_files.append(filePath)

    cmd = '|'.join(out_files)
    print(out_files)
    cmd = 'concat:' + "\"" + cmd + "\""
    cmd = 'ffmpeg -i ' + cmd + ' -acodec copy -vcodec copy -absf aac_adtstoasc ' + out_path_file
    print(execCmd(cmd))


def videoCurv():
    """
    è½¬æ¢è§†é¢‘æ ¼å¼
    :return:
    """
    # è½¬æ¢input.mp4 ä¸º output.avi
    FFmpeg(inputs={in_path: None}, outputs={out_path: None}).run()


def execCmd(cmd):
    """
    æ‰§è¡Œè®¡ç®—å‘½ä»¤æ—¶é—´
    """
    r = os.popen(cmd)
    text = r.read().strip()
    r.close()
    return text


if __name__ == '__main__':
    print(sys.argv)
    if len(sys.argv) == 3:
        hls_dir_to_mp4(sys.argv[1], sys.argv[2])
    elif len(sys.argv) > 1:
        hls_dir_to_mp4(sys.argv[1], 'tmp.mp4')
    else:
        print('è¯·è¾“å…¥è§†é¢‘æ‰€åœ¨ç›®å½•path')
    # hls_dir_to_mp4(
    #     in_path_dir='/Users/bunny/Library/Containers/com.tencent.tenvideo/Data/Library/Application Support/Download/video/g00208rhr0m.320092.hls',
    #     out_path_file='1.mp4');

```



### æ‰“å®Œæ”¶å·¥ ä½¿ç”¨æ–¹æ³•

> **1.å®‰è£…ffmpeg**
>
> - ``` brew install ffmpeg```

> **2.[å®‰è£…Python3](https://www.python.org/downloads/)**
>
> **3.å®‰è£…pipenv**
>
> - ```pip install pipenv```
>
> **4.åˆ›å»ºè™šæ‹Ÿç¯å¢ƒå¹¶å®‰è£…ä¾èµ–åŒ…**
>
> - ``` pipenv shell```
>
> **5.è¿›å…¥è™šæ‹Ÿç¯å¢ƒå¹¶æ‰§è¡Œè„šæœ¬**
>
> - ```pipenv shell```
>
> - ```python tencent_video.py /Users/ç”¨æˆ·/Library/Containers/com.tencent.tenvideo/Data/Library/Application Support/Download/video/g00208rhr0m.320092.hls out.mp4```
>



å®Œç»“

